# 项目重构计划

> **目标**: 优化代码结构，使其符合七大设计原则  
> **预计时间**: 分阶段实施，优先处理高优先级问题  
> **最后更新**: 2024年

---

## 📋 重构阶段规划

### 阶段一：基础架构优化（高优先级）

#### 1.1 创建接口层
**目标**: 为所有管理器创建接口，实现依赖倒置原则

**需要创建的接口**:
- `IInputManager` - 输入管理接口
- `ILayerManager` - 层管理接口
- `ICameraManager` - 摄像机管理接口
- `IGameManager` - 游戏管理接口
- `IEventManager` - 事件管理接口
- `ISaveManager` - 存档管理接口
- `ISceneBounds` - 场景边界接口

**文件位置**: `Assets/Scenes/0_Core/Interfaces/`

**预计时间**: 1-2小时

---

#### 1.2 创建简单的依赖注入容器
**目标**: 替代直接单例访问，实现依赖注入

**需要创建**:
- `ServiceLocator.cs` - 服务定位器（简单实现）
- 或使用轻量级DI容器

**文件位置**: `Assets/Scenes/0_Core/Utilities/DependencyInjection/`

**预计时间**: 2-3小时

---

#### 1.3 拆分 PlayerController
**目标**: 遵循单一职责原则，将大类拆分为小组件

**拆分方案**:
```
PlayerController (保留核心协调)
├── PlayerMovement.cs          // 移动控制
├── PlayerJump.cs              // 跳跃控制
├── GroundChecker.cs           // 地面检测
├── PlayerSpriteFlipper.cs     // 精灵翻转
└── PlayerRenderInitializer.cs // 渲染层初始化
```

**文件位置**: `Assets/Scenes/1_Gameplay/Player/Components/`

**预计时间**: 3-4小时

---

#### 1.4 移除 FindObjectOfType
**目标**: 使用依赖注入或序列化引用替代

**需要修改的文件**:
- `PlayerController.cs`
- `PlayerBoundaryChecker.cs`
- `FollowBehavior.cs`
- `ExplorationScene.cs`
- `BossBattleScene.cs`

**方法**: 
- 使用 `[SerializeField]` 在Inspector中赋值
- 或通过依赖注入获取

**预计时间**: 2-3小时

---

### 阶段二：系统重构（中优先级）

#### 2.1 重构 CameraManager
**目标**: 使用工厂模式，支持开闭原则

**需要创建**:
- `ICameraSceneFactory.cs` - 场景工厂接口
- `CameraSceneFactory.cs` - 场景工厂实现
- 使用注册表模式替代switch语句

**预计时间**: 2-3小时

---

#### 2.2 拆分 LayerManager
**目标**: 分离视差计算逻辑

**拆分方案**:
```
LayerManager (保留层管理)
├── ParallaxController.cs      // 视差计算
└── LayerSettingsManager.cs    // 层配置管理
```

**文件位置**: `Assets/Scenes/0_Core/Managers/Layer/`

**预计时间**: 3-4小时

---

#### 2.3 改进事件系统
**目标**: 使用类型安全的事件系统

**需要创建**:
- 泛型事件系统
- 类型安全的事件订阅/发布

**预计时间**: 2-3小时

---

#### 2.4 创建配置系统
**目标**: 提取硬编码值到配置文件

**需要创建**:
- `GameConfig.cs` - ScriptableObject配置
- `LayerConfig.cs` - 层配置
- `PlayerConfig.cs` - 玩家配置

**预计时间**: 2-3小时

---

### 阶段三：代码质量提升（低优先级）

#### 3.1 统一命名规范
**目标**: 建立并执行命名约定

**预计时间**: 1-2小时

---

#### 3.2 添加空值检查
**目标**: 提高代码健壮性

**预计时间**: 1-2小时

---

#### 3.3 改进日志系统
**目标**: 使用统一的日志管理

**需要创建**:
- `Logger.cs` - 统一日志系统
- 支持日志级别和条件编译

**预计时间**: 1-2小时

---

## 🎯 实施顺序建议

### 第一步：创建接口层（1-2天）
1. 创建所有接口
2. 让现有管理器实现接口
3. 更新引用（暂时仍使用单例，但通过接口访问）

### 第二步：拆分 PlayerController（1-2天）
1. 创建各个组件类
2. 逐步迁移功能
3. 测试确保功能正常

### 第三步：实现依赖注入（1-2天）
1. 创建ServiceLocator
2. 注册所有服务
3. 更新代码使用依赖注入

### 第四步：移除 FindObjectOfType（1天）
1. 使用序列化引用或依赖注入
2. 更新所有相关代码

### 第五步：重构 CameraManager（1天）
1. 实现工厂模式
2. 移除switch语句

### 第六步：拆分 LayerManager（1-2天）
1. 提取视差逻辑
2. 提取配置管理

### 第七步：其他优化（按需）
- 改进事件系统
- 创建配置系统
- 代码质量提升

---

## 📝 注意事项

1. **逐步重构**: 不要一次性修改所有代码，分阶段进行
2. **保持功能**: 每次重构后都要测试，确保功能正常
3. **版本控制**: 每个阶段完成后提交代码
4. **文档更新**: 重构后更新相关文档

---

## ✅ 检查清单

完成每个阶段后，检查：

- [ ] 代码编译通过
- [ ] 功能测试通过
- [ ] 没有引入新的警告或错误
- [ ] 代码符合设计原则
- [ ] 相关文档已更新

---

## 🚀 开始重构

现在开始第一阶段的重构工作！
