# é‡æ„åç»­æ­¥éª¤æŒ‡å—

> **å½“å‰è¿›åº¦**: å·²å®Œæˆæ¥å£å±‚åˆ›å»ºå’ŒPlayerControlleræ‹†åˆ†çš„åŸºç¡€å·¥ä½œ  
> **ä¸‹ä¸€æ­¥**: å®Œæˆå‰©ä½™çš„é‡æ„å·¥ä½œ

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

1. **åˆ›å»ºäº†æ¥å£å±‚**
   - `IInputManager.cs`
   - `ILayerManager.cs`
   - `ICameraManager.cs`
   - `IEventManager.cs`
   - `ISceneBounds.cs`

2. **åˆ›å»ºäº†ä¾èµ–æ³¨å…¥å®¹å™¨**
   - `ServiceLocator.cs` - ç®€å•çš„æœåŠ¡å®šä½å™¨

3. **æ‹†åˆ†äº†PlayerController**
   - `PlayerMovement.cs` - ç§»åŠ¨æ§åˆ¶
   - `GroundChecker.cs` - åœ°é¢æ£€æµ‹
   - `PlayerJump.cs` - è·³è·ƒæ§åˆ¶
   - `PlayerSpriteFlipper.cs` - ç²¾çµç¿»è½¬
   - `PlayerRenderInitializer.cs` - æ¸²æŸ“å±‚åˆå§‹åŒ–

4. **æ›´æ–°äº†ç®¡ç†å™¨å®ç°æ¥å£**
   - `InputManager` ç°åœ¨å®ç° `IInputManager`
   - `LayerManager` ç°åœ¨å®ç° `ILayerManager`

---

## ğŸ“‹ æ¥ä¸‹æ¥éœ€è¦åšçš„äº‹æƒ…

### ç¬¬ä¸€æ­¥ï¼šæ³¨å†ŒæœåŠ¡åˆ°ServiceLocatorï¼ˆé‡è¦ï¼ï¼‰

åœ¨ `GameManager` æˆ–ä¸“é—¨çš„åˆå§‹åŒ–è„šæœ¬ä¸­æ³¨å†Œæ‰€æœ‰æœåŠ¡ï¼š

```csharp
// åœ¨ GameManager.Awake() æˆ–ä¸“é—¨çš„åˆå§‹åŒ–è„šæœ¬ä¸­
var serviceLocator = ServiceLocator.Instance;

// æ³¨å†Œæ‰€æœ‰æœåŠ¡
serviceLocator.Register<IInputManager>(InputManager.Instance);
serviceLocator.Register<ILayerManager>(LayerManager.Instance);
serviceLocator.Register<ICameraManager>(CameraManager.Instance);
serviceLocator.Register<IEventManager>(EventManager.Instance);
// ... å…¶ä»–æœåŠ¡
```

**æ–‡ä»¶ä½ç½®**: å¯ä»¥åœ¨ `GameManager.cs` ä¸­æ·»åŠ ï¼Œæˆ–åˆ›å»º `GameInitializer.cs`

---

### ç¬¬äºŒæ­¥ï¼šæ›´æ–°PlayerControllerä½¿ç”¨æ–°ç»„ä»¶

ç°åœ¨ `PlayerController` å¯ä»¥ç®€åŒ–ä¸ºåè°ƒå™¨ï¼Œæˆ–è€…ç›´æ¥ç§»é™¤ï¼Œä½¿ç”¨æ–°çš„ç»„ä»¶ç³»ç»Ÿï¼š

**é€‰é¡¹A**: ä¿ç•™ `PlayerController` ä½œä¸ºåè°ƒå™¨ï¼ˆæ¨èï¼‰
- ä¿ç•™åŸºæœ¬çš„åˆå§‹åŒ–é€»è¾‘
- ç§»é™¤å·²æ‹†åˆ†åˆ°ç»„ä»¶çš„åŠŸèƒ½
- ä½œä¸ºç»„ä»¶çš„åè°ƒè€…

**é€‰é¡¹B**: å®Œå…¨ç§»é™¤ `PlayerController`
- æ‰€æœ‰åŠŸèƒ½éƒ½ç”±ç»„ä»¶å¤„ç†
- åœ¨GameObjectä¸Šç›´æ¥æ·»åŠ å„ä¸ªç»„ä»¶

**å»ºè®®**: å…ˆä½¿ç”¨é€‰é¡¹Aï¼Œé€æ­¥è¿ç§»åˆ°é€‰é¡¹B

---

### ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°å…¶ä»–ç®¡ç†å™¨å®ç°æ¥å£

éœ€è¦æ›´æ–°çš„ç®¡ç†å™¨ï¼š

1. **CameraManager** - å®ç° `ICameraManager`
2. **EventManager** - å®ç° `IEventManager`
3. **SceneBounds** - å®ç° `ISceneBounds`
4. **GameManager** - åˆ›å»ºå¹¶å®ç° `IGameManager`ï¼ˆå¦‚æœåˆ›å»ºäº†ï¼‰
5. **SaveManager** - åˆ›å»ºå¹¶å®ç° `ISaveManager`ï¼ˆå¦‚æœåˆ›å»ºäº†ï¼‰

---

### ç¬¬å››æ­¥ï¼šç§»é™¤FindObjectOfType

éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š

1. **PlayerController.cs** (å¦‚æœä¿ç•™)
   - ç§»é™¤ `FindObjectOfType<SceneBounds>()`
   - ä½¿ç”¨åºåˆ—åŒ–å¼•ç”¨æˆ–ä¾èµ–æ³¨å…¥

2. **PlayerBoundaryChecker.cs**
   - ä½¿ç”¨ `[SerializeField]` å¼•ç”¨ `SceneBounds`
   - æˆ–åœ¨Inspectorä¸­æ‰‹åŠ¨èµ‹å€¼

3. **FollowBehavior.cs**
   - ä½¿ç”¨ `[SerializeField]` å¼•ç”¨ `PlayerController` æˆ– `Transform`
   - æˆ–é€šè¿‡é…ç½®ä¼ é€’

4. **ExplorationScene.cs**
   - åŒä¸Š

5. **BossBattleScene.cs**
   - åŒä¸Š

---

### ç¬¬äº”æ­¥ï¼šé‡æ„CameraManagerä½¿ç”¨å·¥å‚æ¨¡å¼

åˆ›å»ºå·¥å‚æ¥æ›¿ä»£switchè¯­å¥ï¼š

1. åˆ›å»º `ICameraSceneFactory.cs`
2. åˆ›å»º `CameraSceneFactory.cs`
3. ä½¿ç”¨æ³¨å†Œè¡¨æ¨¡å¼æ³¨å†Œåœºæ™¯ç±»å‹
4. æ›´æ–° `CameraManager` ä½¿ç”¨å·¥å‚

---

### ç¬¬å…­æ­¥ï¼šæ‹†åˆ†LayerManager

1. åˆ›å»º `ParallaxController.cs` - æå–è§†å·®è®¡ç®—é€»è¾‘
2. åˆ›å»º `LayerSettingsManager.cs` - æå–é…ç½®ç®¡ç†
3. æ›´æ–° `LayerManager` ä½¿ç”¨è¿™äº›æ–°ç±»

---

### ç¬¬ä¸ƒæ­¥ï¼šæµ‹è¯•å’ŒéªŒè¯

åœ¨æ¯ä¸ªæ­¥éª¤å®Œæˆåï¼š

1. **ç¼–è¯‘æµ‹è¯•**: ç¡®ä¿ä»£ç èƒ½ç¼–è¯‘é€šè¿‡
2. **åŠŸèƒ½æµ‹è¯•**: ç¡®ä¿æ¸¸æˆåŠŸèƒ½æ­£å¸¸
3. **æ€§èƒ½æµ‹è¯•**: ç¡®ä¿æ²¡æœ‰æ€§èƒ½å›å½’
4. **ä»£ç å®¡æŸ¥**: æ£€æŸ¥æ˜¯å¦ç¬¦åˆè®¾è®¡åŸåˆ™

---

## ğŸ¯ ä¼˜å…ˆçº§æ’åº

### é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®Œæˆï¼‰

1. âœ… **æ³¨å†ŒæœåŠ¡åˆ°ServiceLocator** - å¿…é¡»å®Œæˆï¼Œå¦åˆ™æ–°ç»„ä»¶æ— æ³•å·¥ä½œ
2. âœ… **æ›´æ–°PlayerController** - ç§»é™¤é‡å¤ä»£ç ï¼Œä½¿ç”¨æ–°ç»„ä»¶
3. âœ… **æµ‹è¯•æ–°ç»„ä»¶ç³»ç»Ÿ** - ç¡®ä¿PlayeråŠŸèƒ½æ­£å¸¸

### ä¸­ä¼˜å…ˆçº§ï¼ˆæœ¬å‘¨å®Œæˆï¼‰

4. **æ›´æ–°å…¶ä»–ç®¡ç†å™¨å®ç°æ¥å£**
5. **ç§»é™¤FindObjectOfType**
6. **é‡æ„CameraManager**

### ä½ä¼˜å…ˆçº§ï¼ˆåç»­ä¼˜åŒ–ï¼‰

7. **æ‹†åˆ†LayerManager**
8. **æ”¹è¿›äº‹ä»¶ç³»ç»Ÿ**
9. **åˆ›å»ºé…ç½®ç³»ç»Ÿ**

---

## ğŸ“ å…·ä½“æ“ä½œæ­¥éª¤

### æ“ä½œ1: åˆ›å»ºæœåŠ¡æ³¨å†Œè„šæœ¬

åˆ›å»º `Assets/Scenes/0_Core/Managers/GameInitializer.cs`:

```csharp
using Core.Utilities.DependencyInjection;
using Core.Interfaces;
using Core.Managers;

public class GameInitializer : MonoBehaviour
{
    private void Awake()
    {
        RegisterServices();
    }
    
    private void RegisterServices()
    {
        var serviceLocator = ServiceLocator.Instance;
        
        // æ³¨å†Œæ‰€æœ‰æœåŠ¡
        serviceLocator.Register<IInputManager>(InputManager.Instance);
        serviceLocator.Register<ILayerManager>(LayerManager.Instance);
        serviceLocator.Register<ICameraManager>(CameraManager.Instance);
        serviceLocator.Register<IEventManager>(EventManager.Instance);
        
        Debug.Log("GameInitializer: All services registered!");
    }
}
```

å°†è¿™ä¸ªè„šæœ¬æ·»åŠ åˆ°åœºæ™¯ä¸­çš„Managerså¯¹è±¡ä¸Šï¼Œç¡®ä¿å®ƒåœ¨å…¶ä»–ç®¡ç†å™¨ä¹‹å‰åˆå§‹åŒ–ã€‚

---

### æ“ä½œ2: æ›´æ–°PlayerController

ç®€åŒ– `PlayerController.cs`ï¼Œç§»é™¤å·²æ‹†åˆ†åˆ°ç»„ä»¶çš„åŠŸèƒ½ï¼š

```csharp
// ä¿ç•™åŸºæœ¬çš„Rigidbody2Dè®¾ç½®
// ç§»é™¤ç§»åŠ¨ã€è·³è·ƒã€åœ°é¢æ£€æµ‹ã€ç²¾çµç¿»è½¬ã€æ¸²æŸ“å±‚åˆå§‹åŒ–é€»è¾‘
// è¿™äº›ç°åœ¨ç”±ç»„ä»¶å¤„ç†
```

æˆ–è€…å®Œå…¨ç§»é™¤ `PlayerController`ï¼Œç›´æ¥åœ¨Player GameObjectä¸Šæ·»åŠ ï¼š
- `PlayerMovement`
- `GroundChecker`
- `PlayerJump`
- `PlayerSpriteFlipper`
- `PlayerRenderInitializer`
- `PlayerBoundaryChecker` (å·²å­˜åœ¨)

---

### æ“ä½œ3: æ›´æ–°åœºæ™¯é…ç½®

åœ¨Unityç¼–è¾‘å™¨ä¸­ï¼š

1. é€‰æ‹©Player GameObject
2. ç§»é™¤æ—§çš„ `PlayerController` ç»„ä»¶ï¼ˆå¦‚æœé€‰æ‹©å®Œå…¨ç§»é™¤ï¼‰
3. æ·»åŠ æ–°çš„ç»„ä»¶ï¼š
   - `PlayerMovement`
   - `GroundChecker`
   - `PlayerJump`
   - `PlayerSpriteFlipper`
   - `PlayerRenderInitializer`
4. é…ç½®å„ä¸ªç»„ä»¶çš„å‚æ•°
5. åœ¨ `PlayerBoundaryChecker` ä¸­ï¼Œé€šè¿‡Inspectorè®¾ç½® `SceneBounds` å¼•ç”¨

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¼ºåˆ¶ä¾èµ–æ³¨å…¥**: æ‰€æœ‰ç»„ä»¶å¿…é¡»é€šè¿‡ServiceLocatorè·å–ä¾èµ–ï¼Œä¸å†æ”¯æŒå•ä¾‹æ¨¡å¼
2. **é€æ­¥è¿ç§»**: ä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰ä»£ç ï¼Œåˆ†é˜¶æ®µè¿›è¡Œ
3. **æµ‹è¯•ä¼˜å…ˆ**: æ¯æ¬¡ä¿®æ”¹åéƒ½è¦æµ‹è¯•åŠŸèƒ½
4. **ç‰ˆæœ¬æ§åˆ¶**: æ¯ä¸ªé˜¶æ®µå®Œæˆåæäº¤ä»£ç 

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: æ–°ç»„ä»¶æ‰¾ä¸åˆ°InputManagerï¼Ÿ

**A**: 
1. ç¡®ä¿ `GameInitializer` åœ¨åœºæ™¯ä¸­
2. ç¡®ä¿ `GameInitializer` çš„æ‰§è¡Œé¡ºåºè®¾ç½®ä¸º-100ï¼ˆåœ¨Script Execution Orderä¸­ï¼‰
3. ç¡®ä¿ `InputManager` åœ¨åœºæ™¯ä¸­
4. æ£€æŸ¥Consoleä¸­çš„é”™è¯¯ä¿¡æ¯

### Q: Playerä¸ç§»åŠ¨äº†ï¼Ÿ

**A**: æ£€æŸ¥ï¼š
1. `PlayerMovement` ç»„ä»¶æ˜¯å¦æ·»åŠ 
2. `Rigidbody2D` æ˜¯å¦å­˜åœ¨
3. InputManageræ˜¯å¦æ­£å¸¸æ³¨å†Œ

### Q: Playerä¸èƒ½è·³è·ƒäº†ï¼Ÿ

**A**: æ£€æŸ¥ï¼š
1. `PlayerJump` ç»„ä»¶æ˜¯å¦æ·»åŠ 
2. `GroundChecker` ç»„ä»¶æ˜¯å¦å­˜åœ¨
3. InputManagerçš„è·³è·ƒäº‹ä»¶æ˜¯å¦æ­£å¸¸è§¦å‘

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [é‡æ„è®¡åˆ’.md](./é‡æ„è®¡åˆ’.md) - å®Œæ•´çš„é‡æ„è®¡åˆ’
- [ä»£ç å®¡æŸ¥æŠ¥å‘Š-è®¾è®¡åŸåˆ™åˆ†æ.md](./ä»£ç å®¡æŸ¥æŠ¥å‘Š-è®¾è®¡åŸåˆ™åˆ†æ.md) - é—®é¢˜åˆ†æ

---

**ä¸‹ä¸€æ­¥**: å®Œæˆ"æ“ä½œ1"å’Œ"æ“ä½œ2"ï¼Œç„¶åæµ‹è¯•æ–°ç»„ä»¶ç³»ç»Ÿï¼
