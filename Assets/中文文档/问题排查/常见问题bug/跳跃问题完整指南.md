# 跳跃问题完整指南

> 包含快速修复和详细排查的完整指南。
> 最后更新：2026-02-13

---

## 目录

1. [快速修复（3步）](#快速修复3步)
2. [详细排查指南](#详细排查指南)
3. [常见问题解决](#常见问题解决)
4. [调试技巧](#调试技巧)
5. [推荐设置值](#推荐设置值)

---

## 快速修复（3步）

### 问题：显示 "Cannot jump: Not grounded! IsGrounded: False"

这说明地面检测失败了。按照以下步骤快速修复：

### 步骤 1: 检查 Ground Layer 设置（最重要！）

1. 确保 Unity 中已创建 `Ground` 物理层（`Edit > Project Settings > Tags and Layers > 图层`）
2. 选择 **Player** 对象
3. 在 Inspector 中找到 **GroundChecker** 组件
4. 找到 **Ground Layer** 字段
5. **必须**设置为 `Ground` 层（只勾选 Ground）

**注意**：
- **禁止**设为 `Nothing` — 会直接报错并禁用检测
- **不推荐**设为 `Everything` — 会导致伤害区域等被误判为地面（会收到 LogWarning 警告）
- 详见《代码规范与常见问题》「禁止兜底机制」

### 步骤 2: 确认地面物体的 Layer

1. 选择场景中的**地面方块/平台**
2. 在 Inspector 顶部的 **Layer** 下拉菜单中确认为 `Ground`
3. **红色伤害区域**不要放在 `Ground` 层（用 `Default` 或 `Hazard` 层）

### 步骤 3: 检查检测距离和地面碰撞体

1. **Ground Check Distance**: 默认 `0.3`，如果不够可增加到 `0.5`
2. 确保地面对象有 **Box Collider 2D** 组件
3. 确保地面在 Player 下方

---

## 详细排查指南

### 1. 检查输入系统

- [ ] 按 `Space` 键时，Console 中是否显示 "Player jumped!" 或 "Cannot jump"？
  - 没有任何消息 → 输入事件没有触发
  - "Cannot jump" → 地面检测有问题
  - "Player jumped!" → 可能是物理设置问题

### 2. 检查 InputManager

- [ ] 在 Hierarchy 中是否有 `InputManager` 对象？
- [ ] Console 中是否有 `[Singleton] InputManager 实例未找到！` 错误？（Singleton 不会自动创建，需要手动添加）
- [ ] `Edit > Project Settings > Input Manager` 中是否有 `Jump` 输入轴？

### 3. 检查 GroundChecker 组件

在 Inspector 中检查 Player 对象的 `GroundChecker` 组件：

- [ ] **Ground Layer**: 必须设为 `Ground`（不是 Nothing、不是 Everything）
- [ ] **Ground Check Distance**: `0.3` 或更大
- [ ] **Max Ground Angle**: `60` 度（默认值，一般不需要改）
- [ ] **Show Debug Info**: 勾选可以看到调试射线和日志

### 4. 检查 PlayerJump 组件

- [ ] **Jump Force**: `8` 或更大
- [ ] **Require Grounded**: 勾选（否则可以空中跳）

### 5. 检查 Rigidbody2D

- [ ] **Body Type**: `Dynamic`（不是 Kinematic 或 Static）
- [ ] **Gravity Scale**: `1`（0 = 无重力，物体会浮空）
- [ ] **Freeze Rotation Z**: 勾选（防止旋转）

### 6. 检查地面对象

- [ ] 有 `Box Collider 2D` 组件？
- [ ] **Layer** 设为 `Ground`？
- [ ] **Is Trigger** 未勾选？
- [ ] Position Y 值小于 Player？

---

## 常见问题解决

### 问题 1: 按 Space 没有任何反应

**原因**：InputManager 未初始化，或 Jump 输入轴未配置。

**解决**：
1. 确保 Hierarchy 中有 `InputManager` 对象（Singleton 不会自动创建）
2. `Edit > Project Settings > Input Manager` 中确认 `Jump` 的 Positive Button 是 `space`

### 问题 2: Console 显示 "Cannot jump: Not grounded"

**原因**：地面检测失败。

**解决**：
1. 检查 GroundChecker 的 **Ground Layer** 是否为 `Ground`
2. 检查地面物体的 **Layer** 是否为 `Ground`
3. 增大 **Ground Check Distance**（`0.3` → `0.5`）
4. 开启 **Show Debug Info** 查看射线（绿色 = 检测到，红色 = 未检测到）

### 问题 3: 站在伤害区域上连续跳跃

**原因**：伤害区域被误判为地面。

**解决**：
1. 确保伤害区域的 **Layer** 不是 `Ground`（用 `Default` 或 `Hazard`）
2. GroundChecker 的 **Ground Layer** 只勾选 `Ground` 层

### 问题 4: 碰到墙壁时被"粘住"

**原因**：射线打到墙壁表面被误判为地面。

**解决**：
- GroundChecker 已内置法线角度过滤（`maxGroundAngle` 默认 60°）
- 垂直墙壁的法线 `normal.y ≈ 0`，会被自动排除
- 如果仍有问题，可适当减小 `maxGroundAngle`

### 问题 5: 能跳但跳得很低

**原因**：Jump Force 太小或 Gravity Scale 太大。

**解决**：增大 **Jump Force**（8 → 15），确认 **Gravity Scale** 为 `1`。

### 问题 6: 玩家掉出场景

**原因**：没有地面或地面位置不对。

**解决**：创建 Ground 对象（Position `(0, -3, 0)`，Scale `(10, 1, 1)`），添加 Box Collider 2D，Layer 设为 `Ground`。

---

## 调试技巧

### 方法 1: 查看调试射线

1. 运行场景
2. 切换到 **Scene 视图**
3. 选择 Player 对象
4. 查看向下的射线：**绿色** = 检测到地面，**红色** = 未检测到
5. 射线从碰撞体底部（左、中、右三个点）向下发射

### 方法 2: 查看 Console 信息

开启 GroundChecker 的 **Show Debug Info** 后：
- 会定期输出 `[GroundChecker] Not Grounded - Center/Left/Right` 状态
- 如果命中了物体但被法线过滤排除，会显示 `命中 xxx 但法线 y=0.00 < 阈值 0.50，判定为墙壁`

### 方法 3: 检查错误日志

- `[GroundChecker] Ground Layer 设为 Nothing！` → 去 Inspector 配置 Ground Layer
- `[GroundChecker] Ground Layer 设为 Everything！` → 改为只勾选 Ground 层
- `[Singleton] InputManager 实例未找到！` → 场景中需要手动添加 InputManager 对象

---

## 推荐设置值

| 组件 | 参数 | 推荐值 | 说明 |
|------|------|--------|------|
| **GroundChecker** | Ground Layer | `Ground`（专用层） | 禁止 Nothing，不推荐 Everything |
| **GroundChecker** | Ground Check Distance | `0.3` | 检测距离 |
| **GroundChecker** | Max Ground Angle | `60` | 超过此角度视为墙壁 |
| **PlayerJump** | Jump Force | `8~15` | 跳跃力度 |
| **PlayerMovement** | Move Speed | `8` | 移动速度 |
| **Rigidbody2D** | Gravity Scale | `1` | 重力（0 = 无重力） |
| **Rigidbody2D** | Body Type | `Dynamic` | 必须是 Dynamic |
| **Rigidbody2D** | Freeze Rotation Z | 勾选 | 防止旋转 |

---

## 快速检查清单

- [ ] 已创建 `Ground` 物理层（Tags and Layers > 图层）
- [ ] 地面物体 Layer 设为 `Ground`
- [ ] 伤害区域 Layer **不是** `Ground`
- [ ] GroundChecker 的 Ground Layer 设为 `Ground`
- [ ] Ground Check Distance 至少 `0.3`
- [ ] 地面有 Box Collider 2D（Is Trigger 未勾选）
- [ ] Player 有 Rigidbody2D（Dynamic, Gravity Scale = 1）
- [ ] Player 有 Collider2D
- [ ] 场景中有 InputManager 对象

---

**维护者**：开发团队
**最后更新**：2026-02-13
