# 常见问题解答

> 最后更新：2026-02-13

---

## "Some objects were not cleaned up when closing the scene" 警告

### 问题描述
当你关闭场景时，Unity 可能会显示以下警告：
```
Some objects were not cleaned up when closing the scene. 
(Did you spawn new GameObjects from OnDestroy?)
The following scene GameObjects were found:
InputManager
GameManager
EventManager
...
```

### 这是正常的吗？
**是的，这是完全正常的！**

### 为什么会出现这个警告？

这些管理器（`InputManager`、`GameManager`、`EventManager` 等）使用了 **Singleton（单例）模式**，并且设置了 `DontDestroyOnLoad`。

这意味着：
- 它们会在场景切换时保留（这是设计目的）
- 它们不会在场景关闭时被销毁
- 它们会在整个游戏生命周期中持续存在

### 这是预期的行为

这些管理器被设计为：
1. **跨场景存在** - 在切换场景时不需要重新初始化
2. **全局访问** - 任何场景都可以通过 `Manager.Instance` 访问
3. **持久化** - 保持游戏状态和设置

### 什么时候需要担心？

只有在以下情况下才需要担心：
- 对象在场景中重复创建（多个实例）
- 对象在运行时产生内存泄漏
- 对象阻止场景正常关闭

### 总结

| 情况 | 是否正常 | 需要处理 |
|------|---------|---------|
| 关闭场景时出现警告 | 正常 | 不需要 |
| 多个管理器实例 | 异常 | 需要修复 |
| 管理器在场景切换时保留 | 正常 | 不需要 |
| 内存持续增长 | 异常 | 需要检查 |

---

## Singleton 相关问题

### Q: 管理器在 Hierarchy 中看不到？

**A**: 管理器必须**手动添加**到场景中。Singleton **不会自动创建** GameObject（这是 2026-02-13 的改动，删除了自动创建的兜底逻辑）。

如果 Console 中看到 `[Singleton] XXXManager 实例未找到！` 错误，说明场景中缺少该管理器，需要手动创建：
1. 在 Hierarchy 中创建空对象
2. 命名为对应的 Manager 名称
3. 添加对应的脚本组件
4. 在 Inspector 中配置参数

**为什么不自动创建？**
- 自动创建的对象会丢失所有 Inspector 配置（默认值、引用等）
- 这属于「兜底机制」，掩盖了配置错误
- 详见《代码规范与常见问题》「禁止兜底机制」

### Q: 如何重置所有管理器？

**A**: 停止播放模式，然后重新运行场景。管理器会在 `Awake()` 时重新初始化。

### Q: 管理器会占用内存吗？

**A**: 会，但占用量很小。这些管理器只包含必要的引用和设置，不会造成内存问题。

---

## Ground Layer 相关问题

### Q: GroundChecker 报错 "Ground Layer 设为 Nothing"？

**A**: 必须在 Inspector 中配置 Ground Layer 为 `Ground` 物理层。操作步骤：
1. `Edit > Project Settings > Tags and Layers > 图层` 中确认有 `Ground` 层
2. 选择 Player 上的 GroundChecker 组件
3. Ground Layer 字段选择 `Ground`

### Q: GroundChecker 警告 "Ground Layer 设为 Everything"？

**A**: `Everything` 会导致所有碰撞体（包括伤害区域、UI 等）都被当作地面。应只勾选 `Ground` 层。

### Q: 为什么不能用 Everything？

**A**: 使用 Everything 会导致：
- 红色伤害区域被当作地面 → 连跳 bug
- 任何碰撞体都被当作地面 → 不可预测的行为
- 违反「禁止兜底机制」规范——Ground Layer 必须明确指定

---

## 物理相关问题

### Q: 玩家移动在不同帧率下速度不一致？

**A**: 确保物理操作（`rb.velocity`、`AddForce` 等）在 `FixedUpdate()` 中执行，输入读取在 `Update()` 中执行。`PlayerMovement` 已按此方式实现。

### Q: 碰到墙壁时被"粘住"？

**A**: `GroundChecker` 已内置法线角度过滤（默认 60°）。垂直墙壁会被自动排除。如果仍有问题：
1. 检查 GroundChecker 的 `Max Ground Angle` 参数
2. 开启 `Show Debug Info` 查看命中日志

---

## 相关文档

- [跳跃问题完整指南](./跳跃问题完整指南.md)
- [DontDestroyOnLoad 警告说明](./DontDestroyOnLoad警告说明.md)
- [代码规范与常见问题](../../开发规范/代码规范与常见问题.md)

---

**维护者**：开发团队
**最后更新**：2026-02-13
