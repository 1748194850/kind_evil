# 接口实现与类型匹配规范

## 问题概述

本文档记录在实现接口、使用委托和避免命名空间冲突时需要注意的问题。

---

## 1. 接口实现问题

### 问题描述

**错误类型：**
- `error CS1503: Argument 1: cannot convert from 'Core.Managers.XXXManager' to 'Core.Interfaces.IXXXManager'`

**原因：** 类虽然实现了接口所需的所有方法，但没有在类声明中显式声明实现接口，导致类型转换失败。

### 解决方案

**规则：** 如果类需要被注册为接口类型（如通过 ServiceLocator），必须在类声明中显式实现接口。

**修复方法：**
1. 添加接口命名空间的 using 语句：`using Core.Interfaces;`
2. 在类声明中添加接口实现：`public class XXXManager : Singleton<XXXManager>, IXXXManager`

**示例：**

```csharp
// ❌ 错误：没有实现接口
public class CameraManager : Singleton<CameraManager>
{
    // 实现了接口所需的方法，但没有声明实现接口
}

// ✅ 正确：显式实现接口
using Core.Interfaces;

public class CameraManager : Singleton<CameraManager>, ICameraManager
{
    // 实现接口方法
}
```

### 相关文件

以下类需要显式实现接口：
- ✅ `Scenes/0_Core/Managers/CameraManager.cs` → `ICameraManager`
- ✅ `Scenes/0_Core/Managers/InputManager.cs` → `IInputManager`
- ✅ `Scenes/0_Core/Frameworks/EventSystem/EventManager.cs` → `IEventManager`

### 检查清单

在创建新的 Manager 类时：
- [ ] 检查是否有对应的接口定义（`IXXXManager`）
- [ ] 如果需要在 ServiceLocator 中注册为接口类型，必须实现接口
- [ ] 确保类声明中包含接口：`class XXXManager : Singleton<XXXManager>, IXXXManager`
- [ ] 确保所有接口方法都已实现

---

## 2. 委托类型匹配问题

### 问题描述

**错误类型：**
- `error CS0738: 'InputManager' does not implement interface member 'IInputManager.OnJumpPressed'. 'InputManager.OnJumpPressed' cannot implement 'IInputManager.OnJumpPressed' because it does not have the matching return type of 'Action'.`

**原因：** 接口要求使用 `System.Action` 委托类型，但实现类使用了自定义委托类型（即使功能相同），导致类型不匹配。

### 解决方案

**规则：** 接口中定义的委托类型必须与实现类中的委托类型完全一致。

**修复方法：**
1. 删除自定义委托定义
2. 使用接口要求的委托类型（通常是 `System.Action`）

**示例：**

```csharp
// ❌ 错误：使用自定义委托
public delegate void InputAction();
public event InputAction OnJumpPressed;

// ✅ 正确：使用 System.Action（与接口一致）
public event System.Action OnJumpPressed;
```

### 接口定义示例

```csharp
public interface IInputManager
{
    event System.Action OnJumpPressed;
    event System.Action OnJumpReleased;
    // ...
}
```

### 注意事项

- 即使自定义委托与 `System.Action` 功能相同，C# 也要求类型完全匹配
- 接口和实现类必须使用相同的委托类型
- 建议统一使用 `System.Action` 或 `System.Action<T>` 等标准委托类型

---

## 3. 命名空间冲突问题：Debug 类型

### 问题描述

**错误类型：**
- `error CS0234: The type or namespace name 'LogWarning' does not exist in the namespace 'Core.Utilities.Debug'`

**原因：** 项目中存在 `Core.Utilities.Debug` 命名空间（包含 `DebugHelper` 类），当使用 `Debug.LogWarning` 时，编译器可能将其解析为 `Core.Utilities.Debug.LogWarning`，但 `LogWarning` 是 `DebugHelper` 类的实例方法，不是命名空间的静态方法。

### 解决方案

**规则：** 在存在 `Core.Utilities.Debug` 命名空间的项目中，应使用 `UnityEngine.Debug` 完全限定名，避免命名空间冲突。

**修复方法：**
- 将所有 `Debug.LogXXX` 调用替换为 `UnityEngine.Debug.LogXXX`
- 包括：`Log`、`LogWarning`、`LogError` 等

**示例：**

```csharp
// ❌ 可能冲突：如果存在 Core.Utilities.Debug 命名空间
Debug.LogWarning("警告信息");
Debug.LogError("错误信息");

// ✅ 正确：使用完全限定名
UnityEngine.Debug.LogWarning("警告信息");
UnityEngine.Debug.LogError("错误信息");
```

### 相关文件

以下文件已修复：
- ✅ `Scenes/0_Core/Utilities/DependencyInjection/ServiceLocator.cs`

### 注意事项

- 即使没有显式使用 `using Core.Utilities.Debug;`，命名空间冲突仍可能发生
- 使用完全限定名是最安全的做法
- 建议在项目规范中统一使用 `UnityEngine.Debug`

---

## 4. 开发检查清单

在创建新的 Manager 或 Service 类时，请检查：

### 接口实现
- [ ] 类是否需要在 ServiceLocator 中注册为接口类型？
- [ ] 如果是，是否显式实现了对应接口？
- [ ] 类声明中是否包含接口：`class XXX : Singleton<XXX>, IXXX`？

### 委托类型
- [ ] 接口中定义的委托类型是什么？
- [ ] 实现类中的委托类型是否与接口完全一致？
- [ ] 是否使用了 `System.Action` 等标准委托类型？

### 命名空间
- [ ] 是否使用了 `Debug.LogXXX`？如果是，改为 `UnityEngine.Debug.LogXXX`
- [ ] 是否使用了 `Camera` 类型？如果在 Camera 命名空间下，使用 `UnityEngine.Camera`
- [ ] 是否存在命名空间冲突的可能性？

### 类型转换
- [ ] 在 ServiceLocator 中注册时，类型是否能正确转换？
- [ ] 编译时是否有类型转换错误？

---

## 5. 常见错误模式

### 模式 1：忘记实现接口
```csharp
// 错误：类有接口方法，但没有声明实现接口
public class MyManager : Singleton<MyManager>
{
    public void InterfaceMethod() { } // 接口方法
}

// 修复：添加接口实现
public class MyManager : Singleton<MyManager>, IMyManager
{
    public void InterfaceMethod() { }
}
```

### 模式 2：委托类型不匹配
```csharp
// 错误：接口要求 System.Action，但使用了自定义委托
public delegate void MyAction();
public event MyAction OnEvent;

// 修复：使用 System.Action
public event System.Action OnEvent;
```

### 模式 3：命名空间冲突
```csharp
// 错误：可能被解析为 Core.Utilities.Debug.LogWarning
Debug.LogWarning("消息");

// 修复：使用完全限定名
UnityEngine.Debug.LogWarning("消息");
```

---

## 6. 相关文档

- [命名空间冲突问题-Camera类型.md](./命名空间冲突问题-Camera类型.md)

---

## 更新记录

- 2024-XX-XX：初始版本，记录接口实现、委托类型匹配和 Debug 命名空间冲突问题
