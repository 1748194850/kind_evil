# 工程化快速开始指南

## 概述

本指南帮助你在 30 分钟内完成项目工程化的基础配置。

---

## 第一步：代码规范（5分钟）

### 1. 使用 .editorconfig

✅ **已完成**：项目根目录已有 `.editorconfig` 文件

**验证：**
- 打开 Visual Studio 或 Rider
- 检查代码格式化是否按配置执行
- 尝试格式化代码（Ctrl+K, Ctrl+D）

---

## 第二步：版本控制规范（10分钟）

### 1. 提交信息规范

**使用格式：**
```
<type>(<scope>): <subject>

<body>

<footer>
```

**示例：**
```bash
git commit -m "feat(boss): 添加 Boss 状态管理

实现了 Boss 的 Idle、Battle、Dead 状态切换

Closes #123"
```

### 2. 分支命名规范

- `feature/xxx` - 新功能
- `fix/xxx` - Bug 修复
- `hotfix/xxx` - 紧急修复
- `refactor/xxx` - 重构
- `docs/xxx` - 文档更新

### 3. 工作流

```
main (生产)
  └── develop (开发)
      ├── feature/boss-system
      └── fix/jump-bug
```

---

## 第三步：Issue 管理（5分钟）

### 1. 使用 Issue 模板

✅ **已完成**：`.github/ISSUE_TEMPLATE/` 目录已有模板

**使用方法：**
1. 在 GitHub 上点击 "New Issue"
2. 选择对应的模板（Bug 报告 或 功能请求）
3. 填写信息

### 2. 标签规范

建议创建以下标签：
- `bug` - Bug
- `enhancement` - 功能增强
- `documentation` - 文档
- `question` - 问题
- `wontfix` - 不会修复
- `duplicate` - 重复

---

## 第四步：变更日志（5分钟）

### 1. 使用 CHANGELOG.md

✅ **已完成**：项目根目录已有 `CHANGELOG.md`

**维护方法：**
- 每次发布新版本时更新
- 记录所有重要变更
- 使用标准格式

### 2. 版本号规范

使用语义化版本：
- `1.0.0` - 主版本.次版本.修订号
- `1.1.0` - 新增功能
- `1.1.1` - Bug 修复

---

## 第五步：CI/CD（可选，10分钟）

### 1. 启用 GitHub Actions

✅ **已完成**：`.github/workflows/unity-build.yml` 已配置

**启用步骤：**
1. 将工作流文件推送到 GitHub
2. GitHub 会自动检测并启用
3. 在 Actions 标签页查看运行结果

### 2. 首次运行

```bash
# 提交工作流文件
git add .github/workflows/unity-build.yml
git commit -m "ci: 添加 Unity 构建和测试工作流"
git push
```

---

## 检查清单

完成以上步骤后，检查：

### 代码规范
- [ ] .editorconfig 文件存在
- [ ] IDE 能识别配置
- [ ] 代码格式化正常

### 版本控制
- [ ] 了解提交信息格式
- [ ] 了解分支命名规范
- [ ] 了解工作流程

### Issue 管理
- [ ] Issue 模板可用
- [ ] 了解标签使用
- [ ] 知道如何创建 Issue

### 变更日志
- [ ] CHANGELOG.md 存在
- [ ] 了解更新方法
- [ ] 了解版本号规范

### CI/CD（可选）
- [ ] GitHub Actions 已配置
- [ ] 工作流能正常运行
- [ ] 了解如何查看结果

---

## 第六步：代码规范核心原则（必读）

### 1. 禁止兜底机制

**最重要的规范**：不要用代码掩盖配置错误。

```csharp
// ❌ 禁止：配置错了静默回退
if (groundLayer.value == 0) effectiveLayer = -1; // 当 Nothing 用 Everything

// ✅ 正确：配置错了直接报错
if (groundLayer.value == 0)
{
    UnityEngine.Debug.LogError("[GroundChecker] Ground Layer 未配置！");
    isConfigValid = false;
}
```

### 2. 物理与输入分离

```csharp
// ✅ 正确：Update 读输入，FixedUpdate 改物理
void Update() { moveInput = inputManager.GetMoveInput(); }
void FixedUpdate() { rb.velocity = new Vector2(moveInput.x * speed, rb.velocity.y); }

// ❌ 错误：在 Update 里直接改物理
void Update() { rb.velocity = new Vector2(input.x * speed, rb.velocity.y); }
```

### 3. 避免 GameObject 做字典 key

```csharp
// ❌ 目标销毁后 key 变成空引用
Dictionary<GameObject, float> cooldowns;

// ✅ 使用 InstanceID，不持有对象引用
Dictionary<int, float> cooldowns; // key = target.GetInstanceID()
```

### 4. 命名空间限定

在 `Core.Utilities` 命名空间下，`Debug` 会被解析为 `Core.Utilities.Debug`，必须用 `UnityEngine.Debug`。

详见 [代码规范与常见问题](./代码规范与常见问题.md)

---

## 下一步

完成基础配置后，可以继续：

1. **阅读完整指南**
   - 查看 [项目工程化指南](./项目工程化指南.md)
   - 了解更深入的工程化实践

2. **阅读代码规范**
   - 查看 [代码规范与常见问题](./代码规范与常见问题.md)
   - 重点理解「禁止兜底机制」和「物理与性能」章节

3. **实施测试**
   - 搭建单元测试框架
   - 编写核心系统测试

4. **完善文档**
   - 生成 API 文档
   - 完善架构文档

---

## 常见问题

### Q: .editorconfig 不生效？
A: 
- 确保文件在项目根目录
- 重启 IDE
- 检查 IDE 是否支持 EditorConfig

### Q: GitHub Actions 不运行？
A:
- 检查工作流文件语法
- 确保文件在 `.github/workflows/` 目录
- 检查 GitHub 仓库设置中的 Actions 权限

### Q: Singleton Manager 在场景中找不到？
A:
- Singleton **不会自动创建** GameObject
- 必须手动在场景中添加空对象并挂载脚本
- 如果 Console 报 `[Singleton] XXX 实例未找到！`，说明场景中缺少该对象

### Q: GroundChecker 报错 "Ground Layer 设为 Nothing"？
A:
- 在 `Edit > Project Settings > Tags and Layers > 图层` 中创建 `Ground` 层
- 地面物体的 Layer 设为 `Ground`
- GroundChecker Inspector 中 Ground Layer 选择 `Ground`

---

## 相关文档

- [项目工程化指南](./项目工程化指南.md)
- [代码规范与常见问题](./代码规范与常见问题.md)

---

**维护者：** 开发团队  
**最后更新：** 2026-02-13
